<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>פורטל לניהול משימות משפחות מילואימניקים</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #fff;
            color: #000;
        }
        header {
            background-color: #444;
            color: white;
            padding: 1rem;
            text-align: center;
        }
        .container {
            padding: 2rem;
        }
        .screen {
            display: none;
        }
        .active {
            display: block;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #444;
            display: flex;
            justify-content: space-around;
            padding: 0.5rem 0;
        }
        .bottom-nav button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        .bottom-nav button.active {
            font-weight: bold;
        }
        .task-form input,
        .task-form button {
            margin: 0.5rem 0;
            padding: 0.5rem;
            font-size: 16px;
            background-color: #ddd;
            color: black;
            border: none;
        }
        .task-form button {
            background-color: #bbb;
            cursor: pointer;
        }
        .task-form button:hover {
            background-color: #999;
        }
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
        }
        .calendar div {
            border: 1px solid #555;
            padding: 1rem;
            background-color: #eee;
            border-radius: 4px;
            position: relative;
            cursor: pointer;
        }
        .calendar .task {
            padding: 5px;
            margin: 5px 0;
            border-radius: 4px;
            font-size: 12px;
            color: black;
        }
        .details {
            border-top: 1px solid #555;
            margin-top: 10px;
            padding-top: 10px;
        }
        .month-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .month-nav button {
            padding: 5px 10px;
            font-size: 16px;
            cursor: pointer;
            background-color: #ddd;
            color: black;
            border: none;
        }
        .month-nav button:hover {
            background-color: #bbb;
        }
        /* עיצוב רקע התמונה */
        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: -1; /* תמונה ברקע לא תסתיר את התוכן */
        }

        /* הוספת עיצוב עבור כפתור "בחירת רקע" */
        .background-selector {
            text-align: right;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <header>
        <h1>ניהול משימות משפחות מילואימניקים</h1>
    </header>

    <!-- הוספת כפתור להעלאת תמונה בצד ימין למעלה -->
    <div class="container">
        <div class="background-selector">
            <label for="backgroundImageInput">בחירת רקע למסך</label>
            <input type="file" id="backgroundImageInput" accept="image/*" onchange="changeBackgroundImage(event)">
        </div>
    </div>

    <div id="taskScreen" class="container screen active">
        <h2>הוספת משימה</h2>
        <form class="task-form" onsubmit="addTask(event)">
            <input type="text" id="taskName" placeholder="שם המשימה" required>
            <input type="text" id="taskExecutor" placeholder="מבצע המשימה" required>
            <input type="date" id="taskDate" required>
            <input type="time" id="taskTime" required>
            <input type="color" id="taskColor" value="#0078d7" required>
            <input type="file" id="taskAttachment" style="margin-left: 10px;">
            <button type="submit" id="taskFormSubmit">הוסף משימה</button>
        </form>
        <ul id="taskList"></ul>
    </div>

    <div id="calendarScreen" class="container screen">
        <h2>לוח שנה</h2>
        <div class="month-nav">
            <button onclick="changeMonth(-1)">חודש קודם</button>
            <span id="monthYear"></span>
            <button onclick="changeMonth(1)">חודש הבא</button>
        </div>
        <div id="calendar" class="calendar"></div>
        <div id="details" class="details"></div>
    </div>

    <div class="bottom-nav">
        <button id="taskBtn" class="active" onclick="showScreen('taskScreen')">משימות</button>
        <button id="calendarBtn" onclick="showScreen('calendarScreen')">לוח שנה</button>
    </div>

    <script>
        const tasks = [];
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let editIndex = -1;  // משתנה כדי לשמור את אינדקס המשימה לעריכה

        // פונקציה לשינוי רקע הדף
        function changeBackgroundImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const backgroundDiv = document.createElement('div');
                    backgroundDiv.classList.add('background-image');
                    backgroundDiv.style.backgroundImage = `url(${e.target.result})`;
                    document.body.appendChild(backgroundDiv);
                    updateTextColorBasedOnImage(e.target.result);
                }
                reader.readAsDataURL(file);
            }
        }

        function updateTextColorBasedOnImage(imageSrc) {
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                const imageData = ctx.getImageData(0, 0, img.width, img.height);
                let r = 0, g = 0, b = 0;

                // חישוב ממוצע הצבעים בתמונה
                for (let i = 0; i < imageData.data.length; i += 4) {
                    r += imageData.data[i];
                    g += imageData.data[i + 1];
                    b += imageData.data[i + 2];
                }

                r = r / (imageData.data.length / 4);
                g = g / (imageData.data.length / 4);
                b = b / (imageData.data.length / 4);

                const brightness = (r * 0.299 + g * 0.587 + b * 0.114);
                document.body.style.color = brightness < 128 ? 'white' : 'black';
            };
            img.src = imageSrc;
        }

        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');

            const buttons = document.querySelectorAll('.bottom-nav button');
            buttons.forEach(button => button.classList.remove('active'));
            document.getElementById(screenId.replace('Screen', 'Btn')).classList.add('active');

            if (screenId === 'calendarScreen') {
                renderCalendar();
            }
        }

        function addTask(event) {
            event.preventDefault();
            const name = document.getElementById('taskName').value;
            const executor = document.getElementById('taskExecutor').value;
            const date = document.getElementById('taskDate').value;
            const time = document.getElementById('taskTime').value;
            const color = document.getElementById('taskColor').value;
            const attachment = document.getElementById('taskAttachment').files[0];

            const task = {
                name,
                executor,
                date,
                time,
                color,
                attachment: attachment ? URL.createObjectURL(attachment) : null,
                completed: false
            };

            if (editIndex === -1) {
                tasks.push(task);
            } else {
                tasks[editIndex] = task;
                editIndex = -1;
            }
            renderTaskList();
            renderCalendar();
            document.querySelector('.task-form').reset();
        }

        function renderTaskList() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';

            tasks.forEach((task, index) => {
                const taskItem = document.createElement('li');
                taskItem.textContent = `${task.name} - ${task.executor} - ${task.date} ${task.time}`;
                if (task.completed) taskItem.style.textDecoration = 'line-through';

                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'מחק';
                deleteBtn.onclick = () => deleteTask(index);
                taskItem.appendChild(deleteBtn);

                const editBtn = document.createElement('button');
                editBtn.textContent = 'ערוך';
                editBtn.onclick = () => editTask(index);
                taskItem.appendChild(editBtn);

                taskList.appendChild(taskItem);
            });
        }

        function deleteTask(index) {
            tasks.splice(index, 1);
            renderTaskList();
            renderCalendar();
        }

        function editTask(index) {
            editIndex = index;
            const task = tasks[index];
            document.getElementById('taskName').value = task.name;
            document.getElementById('taskExecutor').value = task.executor;
            document.getElementById('taskDate').value = task.date;
            document.getElementById('taskTime').value = task.time;
            document.getElementById('taskColor').value = task.color;
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';

            const monthYear = document.getElementById('monthYear');
            monthYear.textContent = `${currentMonth + 1}/${currentYear}`;

            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();

            for (let i = 1; i <= daysInMonth; i++) {
                const day = new Date(currentYear, currentMonth, i);
                const dayElement = document.createElement('div');
                dayElement.textContent = i;
                dayElement.style.color = 'black';  // התאריכים יהיו תמיד בצבע שחור

                // הוספת המשימות עבור כל יום בלוח השנה
                const taskForDay = tasks.filter(task => task.date === day.toISOString().split('T')[0]);
                taskForDay.forEach(task => {
                    const taskElement = document.createElement('div');
                    taskElement.classList.add('task');
                    taskElement.textContent = task.name;
                    taskElement.style.backgroundColor = task.color;
                    dayElement.appendChild(taskElement);
                });

                calendar.appendChild(dayElement);
            }
        }

        function changeMonth(offset) {
            currentMonth += offset;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }
    </script>
</body>
</html>
